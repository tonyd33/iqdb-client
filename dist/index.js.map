{"version":3,"file":"index.js","sources":["../src/h.ts","../src/util.ts","../src/api.ts"],"sourcesContent":["export interface IQDBClientConfig {\n    baseDomain: string,\n    simlarityPass: number\n    userAgent: string,\n    fetchOptions?: import('node-fetch').RequestInit\n}\n/**'www'search all libs */\nexport type IQDB_SEARCH_LIBRARY_2D = 'danbooru' | 'konachan' | 'yandere' | 'gelbooru' | 'sankaku' | 'e-shuushuu' | 'zerochan' | 'anime-pictures' | 'www'\n/**cosplay, asian models, idols.'3d' search all libs.*/\nexport type IQDB_SEARCH_LIBRARY_3D = '3d' | '3dbooru' | 'idol'\nexport interface IQDB_SEARCH_OPTIONS_GENERAL {\n    forcegray?: boolean\n    fileName?: string\n}\nexport type IQDB_SEARCH_OPTIONS_2D = ({\n    lib: Exclude<IQDB_SEARCH_LIBRARY_2D, 'www'>,\n    service?: undefined\n} | {\n    lib: 'www',\n    service?: Array<IQDBLibs_2D>\n}) & IQDB_SEARCH_OPTIONS_GENERAL\nexport type IQDB_SEARCH_OPTIONS_3D = ({\n    lib: Exclude<IQDB_SEARCH_LIBRARY_3D, '3d'>,\n    service?: undefined\n} | {\n    lib: '3d',\n    service?: Array<IQDBLibs_3D>\n}) & IQDB_SEARCH_OPTIONS_GENERAL\nexport type IQDB_SEARCH_OPTIONS_ALL = IQDB_SEARCH_OPTIONS_2D | IQDB_SEARCH_OPTIONS_3D\n\nexport enum IQDBLibs_2D {\n    danbooru = 1,\n    konachan = 2,\n    'yande.re' = 3,\n    gelbooru = 4,\n    'sankaku channel' = 5,\n    'e-shuushuu' = 6,\n    zerochan = 11,\n    'anime-picture' = 13\n}\nexport enum IQDBLibs_3D {\n    '3dbooru' = 7,\n    'idol' = 9\n}\nexport type IQDB_RESULT_TYPE = 'Safe' | 'Ero' | 'Explicit' | string","export function parseSimilarity(txt: string): number | null {\n    const result = txt.match(/(-?\\d+\\.?\\d*)(%?)/)\n    if (result) {\n        return (result[2] == undefined || result[2] == '') ? parseFloat(result[1]) : parseFloat(result[1]) / 100\n    } else {\n        return null//couldn't parse similarity\n    }\n}\nexport function parseSizeAndType(txt: string) {\n    const result = txt.match(/(\\d+)×(\\d+)(?: \\[([A-z]*)\\])?/)\n    if (result) {\n        return {\n            size: {\n                width: parseInt(result[1]),\n                height: parseInt(result[2])\n            }, type: result[3]\n        }\n    } else {\n        return txt\n    }\n}\nconst baseArray = [\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\", \"@\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"I\", \"J\", \"K\", \"L\", \"M\", \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"U\", \"V\", \"W\", \"X\", \"Y\", \"Z\", \"_\"]\nexport function randomFileName() {\n    const length = 5 + (Math.random() * 10 | 0)\n    const baseArrayLength = baseArray.length\n    let str = ''\n    for (let i = 0; i < length; i++) {\n        str += baseArray[Math.random() * baseArrayLength | 0]\n    }\n    return str + '.jpg'\n}\n","import { parseSimilarity, parseSizeAndType, randomFileName } from \"./util\"\nimport { load } from 'cheerio'\nimport fetch from 'node-fetch'\nimport { IQDB_SEARCH_OPTIONS_ALL, IQDBClientConfig, IQDBLibs_2D, IQDBLibs_3D, IQDB_RESULT_TYPE } from \"./h\"\nimport FormData from 'form-data'\nimport { Readable } from 'stream'\nexport interface Size {\n    width: number\n    height: number\n}\nexport type IQDBSearchResultItem = {\n    head: string,\n    img: string,\n    name?: string,\n    sourceUrl?: string,\n    source?: string[],\n    // number between 0 and 1 or null if no similarity provided\n    similarity: number | null\n} & ({\n    size?: Size,\n    type?: IQDB_RESULT_TYPE\n} | { sizeAndType: string })\nexport type SearchPicResult = SearchPicResultWithError |\n{\n    /**是否找到满足相似度的结果 */\n    ok: boolean,\n    /**返回数据 */\n    data: IQDBSearchResultItem[]\n    /**在哪些库做了搜索 */\n    service: Array<IQDBLibs_2D | IQDBLibs_3D>\n}\nexport interface SearchPicResultWithError {\n    /**是否找到满足相似度的结果 */\n    ok: false,\n    /**是否发生错误 */\n    err?: string\n    data?: IQDBSearchResultItem[]\n}\nexport const defaultConfig: IQDBClientConfig = {\n    baseDomain: 'iqdb.org',\n    simlarityPass: 0.6,\n    userAgent: 'node-fetch/1.0 (+https://github.com/bitinn/node-fetch)',\n}\nconst _addToForm = (form: FormData, array: Array<IQDBLibs_2D | IQDBLibs_3D>) => array.forEach(lib => { form.append('service[]', lib) })\n\n/**\n *\n * @param body 服务器返回的body\n * @param noSource 指示结果中是否应该有source字段\n * @returns\n */\nexport function parseResult(body: string, similarityPass: number, noSource?: boolean) {\n    const $ = load(body)\n    let ok = false\n    const err = $('.err')\n    if (err.length > 0) {\n        return {\n            ok: false,\n            err: err.text()\n        } as SearchPicResultWithError\n    }\n    const service = $('input[type=checkbox][name=\"service[]\"][checked]').toArray().map(element => {\n        const value = parseInt(element.attribs.value)\n        const name = IQDBLibs_2D[value] || IQDBLibs_3D[value]\n        if (!name) console.warn('Unknown lib: ' + value)\n        return value\n    })\n    const data: Array<IQDBSearchResultItem> = $('#pages').children('div').toArray()\n        .map((page): IQDBSearchResultItem => {\n            const rows = $(page).find('tr')\n            const head = $(rows[0]).text()\n            if (head == 'Your image') {\n                const sizeAndType = parseSizeAndType($(rows[3]).text())\n                return {\n                    head,\n                    img: $(rows[1]).find('img').attr('src'),\n                    name: $(rows[2]).text(),\n                    // no similarity for your own image\n                    similarity: null,\n                    ...typeof sizeAndType == 'object' ? sizeAndType : { sizeAndType }\n                }\n            } else if (head == 'No relevant matches') {\n                return\n            } else {\n                let similarity: number | string,\n                    sizeAndType: string | { size: { width: number; height: number }; type: string },\n                    source: string[]\n                if (noSource) {\n                    similarity = parseSimilarity($(rows[3]).text())\n                    sizeAndType = parseSizeAndType($(rows[2]).text())\n                } else {\n                    similarity = parseSimilarity($(rows[4]).text())\n                    sizeAndType = parseSizeAndType($(rows[3]).text())\n                    source = $(rows[2]).text().split(' ')\n                }\n                if (similarity >= similarityPass) ok = true\n                const imgBox = $(rows[1]).find('a')\n\n                return {\n                    head,\n                    sourceUrl: imgBox.attr('href'),\n                    similarity,\n                    img: imgBox.find('img').attr('src'),\n                    ...typeof sizeAndType == 'object' ? sizeAndType : { sizeAndType },\n                    source,\n                }\n            }\n        })\n        .filter(item => item != undefined)\n    return {\n        ok,\n        data,\n        service\n    }\n}\nexport function makeSearchFunc(config: IQDBClientConfig) {\n    return async function searchPic(pic: string | Buffer | Readable, { lib, forcegray, service: libs, fileName }: IQDB_SEARCH_OPTIONS_ALL): Promise<SearchPicResult> {\n        const isMultiLib = lib == 'www' || lib == '3d'\n        const form = new FormData()\n        if (typeof pic == 'string') { form.append('url', pic) }\n        else if (pic instanceof Buffer || pic instanceof Readable) { form.append('file', pic, { filename: fileName ? fileName : randomFileName() }) }\n        else {\n            throw new TypeError('expect string | Buffer | Readable')\n        }\n        if (isMultiLib && libs) _addToForm(form, libs)\n        if (forcegray) form.append('forcegray', 'true')\n        const resp = await fetch(`https://${lib}.${config.baseDomain}`,\n            {\n                method: 'POST',\n                body: form,\n                headers: {\n                    ...form.getHeaders(),\n                    'User-Agent': config.userAgent\n                },\n                ...config.fetchOptions\n            })\n        if (resp.ok) {\n            return parseResult(await resp.text(), config.simlarityPass, !isMultiLib)\n        } else {\n            return {\n                ok: false,\n                err: 'HTTP ' + resp.status\n            } as SearchPicResultWithError\n        }\n    }\n}\nconst searchPic = makeSearchFunc(defaultConfig)\nexport default searchPic\n"],"names":["IQDBLibs_2D","IQDBLibs_3D","parseSimilarity","txt","result","match","undefined","parseFloat","parseSizeAndType","size","width","parseInt","height","type","baseArray","randomFileName","length","Math","random","baseArrayLength","str","i","defaultConfig","baseDomain","simlarityPass","userAgent","_addToForm","form","array","forEach","lib","append","parseResult","body","similarityPass","noSource","$","load","ok","err","text","service","toArray","map","element","value","attribs","name","console","warn","data","children","page","rows","find","head","sizeAndType","img","attr","similarity","source","split","imgBox","sourceUrl","filter","item","makeSearchFunc","config","searchPic","pic","forcegray","libs","fileName","isMultiLib","FormData","Buffer","Readable","filename","TypeError","resp","fetch","method","headers","getHeaders","fetchOptions","status"],"mappings":"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"}